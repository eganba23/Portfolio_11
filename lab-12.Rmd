---
title: "Commentary on Lab 12 - Smoking during pregnancy"
author: "Benjamin Egan"
output: github_document
---

#### Created 4/14/2025

Link to the assignment page, at the time of creation: https://web.archive.org/web/20250414135227/https://datascience4psych.github.io/DataScience4Psych/lab12.html

Link to assignment page as of `r format(Sys.time(), '%B %d %Y')`: https://datascience4psych.github.io/DataScience4Psych/lab12.html

## Commentary on Lab 12

I will be walking through lab 12, designed to practice data manipulation, visualization, hypothesis testing, and calculating confidence intervals. Questions and comments from the lab that I will be addressing will be in bold. My commentary will always have "Commentary:" infront. This can make it easier to quickly skim through the document by searching for the word commentary.

```{r load-packages, message=FALSE, warning = FALSE, echo = FALSE}
library(tidyverse) 
library(tidymodels)
library(openintro)
seed <- set.seed(123)
```

Loading the data
```{r load data}
data(ncbirths)
#view(ncbirths)
```

#### Before analyzing any new dataset, it’s important to get to know your data. Start by summarizing the variables and determining if their data type. Are they categorical? Are they numerical? For numerical variables, check for outliers. If you aren’t sure or want to take a closer look at the data, create a graph.

```{r examine data}
summary(ncbirths)
```

By using summary(), I know there are 7 categorical variables and 6 numerical variables.

I way overengineered looking for outliers, getting help from Chat GPT.
```{r outlier check, warning = FALSE, message = FALSE}


base_outlier_check <- function(variable) {
  ncbirths %>%
  ggplot(aes(x = {{ variable }})) +
    geom_histogram(stat = "count") +
    labs(title = rlang::as_label(rlang::enquo(variable)), y = NULL)
}

map(c("fage", "mage","weeks","visits","gained","weight"), ~ base_outlier_check(!!sym(.x)))

```

mage could have an outlier on the upper end. I don't think weeks has an outlier, even though it's skewed left. visits may have an outlier on the upper end. weight might have one or two on the upper end, but it's skewed left.

Commentary: This was pretty basic, and I made it way harder than it had to be. This could, however, be a good moment to throw it back to lab 8 and show a way to use a function. I would just guide them on the labeling bit, as it can be tricky. You can use do what I did and use base R. This allows you to input all the variables at once using map(). If you use tidyverse for the label and use deparse(substitute(variable)), you have to individually input each function and cannot mass input.

#### What are the cases in this data set? How many cases are there in our sample?

```{r number cases}

ncbirths %>%
nrow()

```

There are 1000 cases, as each row represents an individual birth.

### Create a filtered data frame called ncbirths_white that contains data only from White mothers. Then, calculate the mean of the weights of their babies.

```{r filter only white}

ncbirths_white <- ncbirths %>%
  filter(whitemom == "white")

mean(ncbirths_white$weight)


```

The mean weight of the white babies is 7.25 lbs. The hypothesis states that there is no change in weight since 1995 (i.e. mu = 7.43). Since white babies weigh less, we need to figure out if this is a meaningful difference.

Commentary: You/someone else included a note in the code that says "Mason make this clearer to why we need to actually do this." I don't think you need to explain, if they watched the videos or viewed the slides. What I would like more clarification on is question 3. My imagination for an answer is to create a visual for the data and see if mu falls within the CI in this sample.

### Are the criteria necessary for conducting simulation-based inference satisfied? Explain your reasoning.

```{r should we baby weight hypothesis test}

ncbirths_white %>%
  ggplot(aes(
    x = weight
  ))+
  geom_histogram(stat = "count", color = "blue")+
  geom_vline(xintercept = 7.43, 
               color = "white", 
               linetype = "dashed")+
   geom_vline(xintercept = 7.25, 
               color = "red", 
               linetype = "dashed")+
  annotate("text", 
           x = 4, y = Inf, 
           label = "White = Mu, Red = Sample mean", 
           vjust = 2, 
           color = "black")+
  theme_bw()+
  labs(
    x = "Weight in lbs",
    y = NULL,
    title = "Distriubtion of weight",
    subtitle = "How does this shape up to the popluation mean?"
  )

```
Based on this graph, I would guess that we probably would fail to reject, considering the mean weight is so close to the population weight. But this is only one sample, so it makes sense to use bootstrapping to better estimate the difference.

## Steps for hypothesis testing
- take a bootstrap sample of from the original sample
- calculate this bootstrap sample’s mean
- repeat these two steps a large number of times to create a bootstrap distribution of means centered at the observed sample mean,
- shift this distribution to be centered at the null value by subtracting / adding X to all bootstrap mean (X = difference between mean of bootstrap distribution and null value)
- calculate the p-value as the proportion of bootstrap samples that yielded a sample mean at least as extreme as the observed sample mean.

```{r bootstrap weight}
seed
white_weight_bootstrap <- ncbirths_white %>%
  specify(response = weight) %>% 
  generate(reps = 15000, type = "bootstrap") %>% 
  calculate(stat = "mean")

mean_white_weight_boostrap <- mean(white_weight_bootstrap$stat)

white_weight_bootstrap <-  white_weight_bootstrap %>%
  mutate(Cstat = (stat - 7.43))

white_weight_bootstrap %>%
  summarize(lower = quantile(Cstat, 0.025),
            upper = quantile(Cstat, 0.975))


white_weight_bootstrap %>%
  ggplot(mapping = aes(x = Cstat)) +
  geom_histogram() +
  labs(title = "Bootstrap distribution of means for white baby weight", y = NULL, x = "Means")+
  geom_vline(xintercept = 0, 
               color = "black", 
               linetype = "solid")+
  annotate("text", 
           x = -.03, y = Inf, 
           label = "Pop mean", 
           vjust = 2, 
           color = "black")+
  geom_vline(xintercept = -0.2847633,                 #Lower CI
               color = "blue", 
               linetype = "dashed")+
  geom_vline(xintercept = -0.07682038,               #Upper CI
               color = "blue", 
               linetype = "dashed")+
  annotate("text", 
           x = -0.31, y = Inf, 
           label = "95% CI", 
           vjust = 2, 
           color = "black")+
  theme_bw()
  

# p value
pvalue_white_weight <- white_weight_bootstrap %>%
  mutate(sig = case_when(
    stat >= mean_white_weight_boostrap ~ 1,
    stat <= mean_white_weight_boostrap ~ 0,
  ))

white_weight_sig <- pvalue_white_weight %>%
  filter(sig == 1)

  
 pvalue_white_weight %>%
  group_by(sig)%>% 
  summarise(cnt = n()) %>% 
  mutate(props = round(cnt / sum(cnt), 2))




```


95% CI:(7.145237, 7.35318)

Based on this, it's clear that the population mean falls outside the confidence interval. We would reject the null and say that babies' weight has decreased since 1995.

Commentary: I would break out the step by step instructions. It was easy to figure out how to make the graph based on the slides, so maybe add in a tip to go back and reference the slides?


